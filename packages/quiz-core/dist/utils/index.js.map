{"version":3,"sources":["../../src/utils/scoring.ts"],"sourcesContent":["import type { Question, Quiz, QuizResult, UserAnswer } from \"../types\"\n\n/**\n * Calculate the score for a single question\n */\nexport function calculateQuestionScore(\n  question: Question,\n  userAnswer: UserAnswer | undefined\n): { isCorrect: boolean; points: number } {\n  if (!userAnswer) {\n    return { isCorrect: false, points: 0 }\n  }\n\n  const correctAnswerIds = question.answers\n    .filter((a) => a.isCorrect)\n    .map((a) => a.id)\n\n  // For text input, we can't auto-grade (needs manual review)\n  if (question.type === \"text_input\") {\n    return { isCorrect: false, points: 0 }\n  }\n\n  // Check if user's answers match correct answers exactly\n  const userAnswerIds = new Set(userAnswer.selectedAnswerIds)\n  const correctIds = new Set(correctAnswerIds)\n\n  const isCorrect =\n    userAnswerIds.size === correctIds.size &&\n    [...userAnswerIds].every((id) => correctIds.has(id))\n\n  return {\n    isCorrect,\n    points: isCorrect ? question.points : 0,\n  }\n}\n\n/**\n * Calculate the total quiz result\n */\nexport function calculateQuizResult(\n  quiz: Quiz,\n  userAnswers: UserAnswer[],\n  startTime: Date\n): QuizResult {\n  const answerMap = new Map(userAnswers.map((a) => [a.questionId, a]))\n\n  let correctAnswers = 0\n  let earnedPoints = 0\n  const totalPoints = quiz.questions.reduce((sum, q) => sum + q.points, 0)\n\n  for (const question of quiz.questions) {\n    const result = calculateQuestionScore(question, answerMap.get(question.id))\n    if (result.isCorrect) {\n      correctAnswers++\n    }\n    earnedPoints += result.points\n  }\n\n  const percentage = totalPoints > 0 ? (earnedPoints / totalPoints) * 100 : 0\n  const passed = quiz.passingScore ? percentage >= quiz.passingScore : true\n  const timeSpent = Math.floor((new Date().getTime() - startTime.getTime()) / 1000)\n\n  return {\n    quizId: quiz.id,\n    totalQuestions: quiz.questions.length,\n    correctAnswers,\n    totalPoints,\n    earnedPoints,\n    percentage,\n    passed,\n    timeSpent,\n    answers: userAnswers,\n    completedAt: new Date(),\n  }\n}\n\n/**\n * Shuffle an array using Fisher-Yates algorithm\n */\nexport function shuffleArray<T>(array: T[]): T[] {\n  const shuffled = [...array]\n  for (let i = shuffled.length - 1; i > 0; i--) {\n    const j = Math.floor(Math.random() * (i + 1))\n    ;[shuffled[i], shuffled[j]] = [shuffled[j], shuffled[i]]\n  }\n  return shuffled\n}\n\n/**\n * Prepare quiz by optionally shuffling questions and answers\n */\nexport function prepareQuiz(quiz: Quiz): Quiz {\n  let questions = [...quiz.questions]\n\n  if (quiz.shuffleQuestions) {\n    questions = shuffleArray(questions)\n  }\n\n  if (quiz.shuffleAnswers) {\n    questions = questions.map((q) => ({\n      ...q,\n      answers: shuffleArray(q.answers),\n    }))\n  }\n\n  return {\n    ...quiz,\n    questions,\n  }\n}\n\n/**\n * Format time in seconds to mm:ss string\n */\nexport function formatTime(seconds: number): string {\n  const mins = Math.floor(seconds / 60)\n  const secs = seconds % 60\n  return `${mins.toString().padStart(2, \"0\")}:${secs.toString().padStart(2, \"0\")}`\n}\n\n/**\n * Get progress percentage\n */\nexport function getProgressPercentage(\n  currentIndex: number,\n  totalQuestions: number\n): number {\n  if (totalQuestions === 0) return 0\n  return ((currentIndex + 1) / totalQuestions) * 100\n}\n"],"mappings":";AAKO,SAAS,uBACd,UACA,YACwC;AACxC,MAAI,CAAC,YAAY;AACf,WAAO,EAAE,WAAW,OAAO,QAAQ,EAAE;AAAA,EACvC;AAEA,QAAM,mBAAmB,SAAS,QAC/B,OAAO,CAAC,MAAM,EAAE,SAAS,EACzB,IAAI,CAAC,MAAM,EAAE,EAAE;AAGlB,MAAI,SAAS,SAAS,cAAc;AAClC,WAAO,EAAE,WAAW,OAAO,QAAQ,EAAE;AAAA,EACvC;AAGA,QAAM,gBAAgB,IAAI,IAAI,WAAW,iBAAiB;AAC1D,QAAM,aAAa,IAAI,IAAI,gBAAgB;AAE3C,QAAM,YACJ,cAAc,SAAS,WAAW,QAClC,CAAC,GAAG,aAAa,EAAE,MAAM,CAAC,OAAO,WAAW,IAAI,EAAE,CAAC;AAErD,SAAO;AAAA,IACL;AAAA,IACA,QAAQ,YAAY,SAAS,SAAS;AAAA,EACxC;AACF;AAKO,SAAS,oBACd,MACA,aACA,WACY;AACZ,QAAM,YAAY,IAAI,IAAI,YAAY,IAAI,CAAC,MAAM,CAAC,EAAE,YAAY,CAAC,CAAC,CAAC;AAEnE,MAAI,iBAAiB;AACrB,MAAI,eAAe;AACnB,QAAM,cAAc,KAAK,UAAU,OAAO,CAAC,KAAK,MAAM,MAAM,EAAE,QAAQ,CAAC;AAEvE,aAAW,YAAY,KAAK,WAAW;AACrC,UAAM,SAAS,uBAAuB,UAAU,UAAU,IAAI,SAAS,EAAE,CAAC;AAC1E,QAAI,OAAO,WAAW;AACpB;AAAA,IACF;AACA,oBAAgB,OAAO;AAAA,EACzB;AAEA,QAAM,aAAa,cAAc,IAAK,eAAe,cAAe,MAAM;AAC1E,QAAM,SAAS,KAAK,eAAe,cAAc,KAAK,eAAe;AACrE,QAAM,YAAY,KAAK,QAAO,oBAAI,KAAK,GAAE,QAAQ,IAAI,UAAU,QAAQ,KAAK,GAAI;AAEhF,SAAO;AAAA,IACL,QAAQ,KAAK;AAAA,IACb,gBAAgB,KAAK,UAAU;AAAA,IAC/B;AAAA,IACA;AAAA,IACA;AAAA,IACA;AAAA,IACA;AAAA,IACA;AAAA,IACA,SAAS;AAAA,IACT,aAAa,oBAAI,KAAK;AAAA,EACxB;AACF;AAKO,SAAS,aAAgB,OAAiB;AAC/C,QAAM,WAAW,CAAC,GAAG,KAAK;AAC1B,WAAS,IAAI,SAAS,SAAS,GAAG,IAAI,GAAG,KAAK;AAC5C,UAAM,IAAI,KAAK,MAAM,KAAK,OAAO,KAAK,IAAI,EAAE;AAC3C,KAAC,SAAS,CAAC,GAAG,SAAS,CAAC,CAAC,IAAI,CAAC,SAAS,CAAC,GAAG,SAAS,CAAC,CAAC;AAAA,EACzD;AACA,SAAO;AACT;AAKO,SAAS,YAAY,MAAkB;AAC5C,MAAI,YAAY,CAAC,GAAG,KAAK,SAAS;AAElC,MAAI,KAAK,kBAAkB;AACzB,gBAAY,aAAa,SAAS;AAAA,EACpC;AAEA,MAAI,KAAK,gBAAgB;AACvB,gBAAY,UAAU,IAAI,CAAC,OAAO;AAAA,MAChC,GAAG;AAAA,MACH,SAAS,aAAa,EAAE,OAAO;AAAA,IACjC,EAAE;AAAA,EACJ;AAEA,SAAO;AAAA,IACL,GAAG;AAAA,IACH;AAAA,EACF;AACF;AAKO,SAAS,WAAW,SAAyB;AAClD,QAAM,OAAO,KAAK,MAAM,UAAU,EAAE;AACpC,QAAM,OAAO,UAAU;AACvB,SAAO,GAAG,KAAK,SAAS,EAAE,SAAS,GAAG,GAAG,CAAC,IAAI,KAAK,SAAS,EAAE,SAAS,GAAG,GAAG,CAAC;AAChF;AAKO,SAAS,sBACd,cACA,gBACQ;AACR,MAAI,mBAAmB,EAAG,QAAO;AACjC,UAAS,eAAe,KAAK,iBAAkB;AACjD;","names":[]}