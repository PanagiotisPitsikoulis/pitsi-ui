{
  "$schema": "https://pitsiui.com/schema/registry-item.json",
  "name": "curved-loop",
  "type": "registry:ui",
  "description": "Text marquee along a curved path.",
  "registryDependencies": [],
  "files": [
    {
      "path": "registry/new-york-v4/animations/curved-loop/curved-loop.tsx",
      "content": "\"use client\"\n\nimport {\n  FC,\n  PointerEvent,\n  useEffect,\n  useId,\n  useMemo,\n  useRef,\n  useState,\n} from \"react\"\n\ninterface CurvedLoopProps {\n  marqueeText?: string\n  speed?: number\n  className?: string\n  curveAmount?: number\n  direction?: \"left\" | \"right\"\n  interactive?: boolean\n}\n\nconst CurvedLoop: FC<CurvedLoopProps> = ({\n  marqueeText = \"\",\n  speed = 2,\n  className,\n  curveAmount = 400,\n  direction = \"left\",\n  interactive = true,\n}) => {\n  const text = useMemo(() => {\n    const hasTrailing = /\\s|\\u00A0$/.test(marqueeText)\n    return (\n      (hasTrailing ? marqueeText.replace(/\\s+$/, \"\") : marqueeText) + \"\\u00A0\"\n    )\n  }, [marqueeText])\n\n  const measureRef = useRef<SVGTextElement | null>(null)\n  const textPathRef = useRef<SVGTextPathElement | null>(null)\n  const pathRef = useRef<SVGPathElement | null>(null)\n  const [spacing, setSpacing] = useState(0)\n  const [offset, setOffset] = useState(0)\n  const uid = useId()\n  const pathId = `curve-${uid}`\n  const pathD = `M-100,40 Q500,${40 + curveAmount} 1540,40`\n\n  const dragRef = useRef(false)\n  const lastXRef = useRef(0)\n  const dirRef = useRef<\"left\" | \"right\">(direction)\n  const velRef = useRef(0)\n\n  const textLength = spacing\n  const totalText = textLength\n    ? Array(Math.ceil(1800 / textLength) + 2)\n        .fill(text)\n        .join(\"\")\n    : text\n  const ready = spacing > 0\n\n  useEffect(() => {\n    if (measureRef.current)\n      setSpacing(measureRef.current.getComputedTextLength())\n  }, [text, className])\n\n  useEffect(() => {\n    if (!spacing) return\n    if (textPathRef.current) {\n      const initial = -spacing\n      textPathRef.current.setAttribute(\"startOffset\", initial + \"px\")\n      setOffset(initial)\n    }\n  }, [spacing])\n\n  useEffect(() => {\n    if (!spacing || !ready) return\n    let frame = 0\n    const step = () => {\n      if (!dragRef.current && textPathRef.current) {\n        const delta = dirRef.current === \"right\" ? speed : -speed\n        const currentOffset = parseFloat(\n          textPathRef.current.getAttribute(\"startOffset\") || \"0\"\n        )\n        let newOffset = currentOffset + delta\n        const wrapPoint = spacing\n        if (newOffset <= -wrapPoint) newOffset += wrapPoint\n        if (newOffset > 0) newOffset -= wrapPoint\n        textPathRef.current.setAttribute(\"startOffset\", newOffset + \"px\")\n        setOffset(newOffset)\n      }\n      frame = requestAnimationFrame(step)\n    }\n    frame = requestAnimationFrame(step)\n    return () => cancelAnimationFrame(frame)\n  }, [spacing, speed, ready])\n\n  const onPointerDown = (e: PointerEvent) => {\n    if (!interactive) return\n    dragRef.current = true\n    lastXRef.current = e.clientX\n    velRef.current = 0\n    ;(e.target as HTMLElement).setPointerCapture(e.pointerId)\n  }\n\n  const onPointerMove = (e: PointerEvent) => {\n    if (!interactive || !dragRef.current || !textPathRef.current) return\n    const dx = e.clientX - lastXRef.current\n    lastXRef.current = e.clientX\n    velRef.current = dx\n    const currentOffset = parseFloat(\n      textPathRef.current.getAttribute(\"startOffset\") || \"0\"\n    )\n    let newOffset = currentOffset + dx\n    const wrapPoint = spacing\n    if (newOffset <= -wrapPoint) newOffset += wrapPoint\n    if (newOffset > 0) newOffset -= wrapPoint\n    textPathRef.current.setAttribute(\"startOffset\", newOffset + \"px\")\n    setOffset(newOffset)\n  }\n\n  const endDrag = () => {\n    if (!interactive) return\n    dragRef.current = false\n    dirRef.current = velRef.current > 0 ? \"right\" : \"left\"\n  }\n\n  const cursorStyle = interactive\n    ? dragRef.current\n      ? \"grabbing\"\n      : \"grab\"\n    : \"auto\"\n\n  return (\n    <div\n      className=\"flex min-h-screen w-full items-center justify-center\"\n      style={{ visibility: ready ? \"visible\" : \"hidden\", cursor: cursorStyle }}\n      onPointerDown={onPointerDown}\n      onPointerMove={onPointerMove}\n      onPointerUp={endDrag}\n      onPointerLeave={endDrag}\n    >\n      <svg\n        className=\"block aspect-[100/12] w-full overflow-visible text-[6rem] leading-none font-bold uppercase select-none\"\n        viewBox=\"0 0 1440 120\"\n      >\n        <text\n          ref={measureRef}\n          xmlSpace=\"preserve\"\n          style={{ visibility: \"hidden\", opacity: 0, pointerEvents: \"none\" }}\n        >\n          {text}\n        </text>\n        <defs>\n          <path\n            ref={pathRef}\n            id={pathId}\n            d={pathD}\n            fill=\"none\"\n            stroke=\"transparent\"\n          />\n        </defs>\n        {ready && (\n          <text\n            xmlSpace=\"preserve\"\n            className={`fill-foreground ${className ?? \"\"}`}\n          >\n            <textPath\n              ref={textPathRef}\n              href={`#${pathId}`}\n              startOffset={offset + \"px\"}\n              xmlSpace=\"preserve\"\n            >\n              {totalText}\n            </textPath>\n          </text>\n        )}\n      </svg>\n    </div>\n  )\n}\n\nexport default CurvedLoop\n",
      "type": "registry:ui"
    }
  ],
  "categories": [
    "animations"
  ],
  "tier": "free",
  "readiness": "beta"
}